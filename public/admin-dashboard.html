<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Admin Dashboard - Silvera</title>

    <!--CSS Files-->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.3/font/bootstrap-icons.css">
    <link href="assets/css/style.css" rel="stylesheet"/>
    <style>
      body {
        background: #f8f9fa;
      }
      .admin-header {
        background: #1a1a1a;
        color: white;
        padding: 20px;
      }
      .admin-container {
        max-width: 1200px;
        margin: 0 auto;
      }
      .dashboard-card {
        background: white;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      }
      .stat-box {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 15px;
      }
      .stat-box h5 {
        margin: 0;
        font-size: 14px;
        opacity: 0.9;
      }
      .stat-box .number {
        font-size: 32px;
        font-weight: bold;
        margin-top: 10px;
      }
    </style>
  </head>
  <body>

    <!--page loader-->
    <div class="loader-wrapper">
      <div class="d-flex justify-content-center align-items-center position-absolute top-50 start-50 translate-middle">
        <div class="spinner-border text-white" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>
    </div>
   <!--end loader-->

   <!--start wrapper-->
    <div class="wrapper">

      <!--start header-->
      <div class="admin-header d-flex align-items-center justify-content-between">
        <div>
          <h2 class="mb-0">Admin Dashboard</h2>
          <p class="mb-0 text-white-50">Silvera Management System</p>
        </div>
        <div>
          <button onclick="logout()" class="btn btn-outline-light btn-sm">
            <i class="bi bi-box-arrow-right me-2"></i>Logout
          </button>
        </div>
      </div>
      <!--end header-->

      <!--start content-->
      <div class="admin-container p-4">

        <div class="dashboard-card">
          <h4>Welcome, <span id="adminName">Admin</span>!</h4>
          <p>You are logged in as an administrator. You have access to manage products, categories, orders, and users.</p>
        </div>

        <h5 class="mt-5 mb-3">Dashboard Statistics</h5>
        <div class="row">
          <div class="col-md-6">
            <div class="stat-box">
              <h5>Total Products</h5>
              <div class="number" id="productCount">-</div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="stat-box">
              <h5>Total Orders</h5>
              <div class="number" id="orderCount">-</div>
            </div>
          </div>
        </div>

        <div class="dashboard-card mt-4">
          <h5>Admin Actions</h5>
          <div class="d-grid gap-2 d-sm-flex">
            <button class="btn btn-primary" onclick="alert('Products management coming soon')">Manage Products</button>
            <button class="btn btn-secondary" onclick="alert('Categories management coming soon')">Manage Categories</button>
            <button class="btn btn-info" onclick="alert('Orders management coming soon')">View Orders</button>
          </div>
        </div>

        <div class="dashboard-card mt-4">
          <h5>Admin Account Info</h5>
          <p><strong>Email:</strong> <span id="adminEmail">-</span></p>
          <p><strong>Role:</strong> <span id="adminRole">-</span></p>
          <p><strong>Login Time:</strong> <span id="loginTime">-</span></p>
        </div>
      </div>
      <!--end content-->

    </div>
   <!--end wrapper-->

    <!--JS Files-->
    <script src="assets/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/loader.js"></script>
<script src="assets/js/shared-utilities.js"></script>

    <script>
      // Check if user is logged in and is admin
      document.addEventListener('DOMContentLoaded', () => {
        const token = localStorage.getItem('auth_token');
        const user = JSON.parse(localStorage.getItem('user') || '{}');

        if (!token || !user.id) {
          // Not logged in, redirect to login
          window.location.href = '/authentication-log-in.html';
          return;
        }

        if (user.role !== 'admin') {
          // Not an admin, redirect to customer home
          window.location.href = '/home.html';
          return;
        }

        // Display user info
        document.getElementById('adminName').textContent = user.name || 'Admin';
        document.getElementById('adminEmail').textContent = user.email || '-';
        document.getElementById('adminRole').textContent = user.role || '-';
        document.getElementById('loginTime').textContent = new Date().toLocaleString();

        // Fetch stats
        fetchStats(token);
      });

      async function fetchStats(token) {
        try {
          const [productsRes, ordersRes] = await Promise.all([
            fetch('/api/products?limit=1', {
              headers: { 'Authorization': 'Bearer ' + token }
            }),
            fetch('/api/orders', {
              headers: { 'Authorization': 'Bearer ' + token }
            })
          ]);

          if (productsRes.ok) {
            const products = await productsRes.json();
            document.getElementById('productCount').textContent = Array.isArray(products) ? products.length : '-';
          }

          if (ordersRes.ok) {
            const orders = await ordersRes.json();
            document.getElementById('orderCount').textContent = Array.isArray(orders) ? orders.length : '-';
          }
        } catch (error) {
          console.error('Error fetching stats:', error);
        }
      }

      function logout() {
        localStorage.removeItem('auth_token');
        localStorage.removeItem('user');
        window.location.href = '/';
      }
    </script>

  </body>
</html>
