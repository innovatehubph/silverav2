<!DOCTYPE html>
<html>
<head>
  <title>Silvera Admin</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen p-8">
  <div id="app">
    <h1 class="text-3xl font-bold mb-8">Silvera Admin Panel</h1>
    <div id="login" class="max-w-md">
      <input type="email" id="email" placeholder="Email" class="w-full p-3 mb-4 rounded bg-gray-800 border border-gray-700">
      <input type="password" id="password" placeholder="Password" class="w-full p-3 mb-4 rounded bg-gray-800 border border-gray-700">
      <button onclick="login()" class="w-full p-3 bg-blue-600 rounded font-bold">Login</button>
    </div>
    <div id="dashboard" class="hidden">
      <div class="grid grid-cols-4 gap-4 mb-8" id="stats"></div>
      <div class="grid grid-cols-2 gap-8">
        <div><h2 class="text-xl font-bold mb-4">Orders</h2><div id="orders" class="space-y-2"></div></div>
        <div><h2 class="text-xl font-bold mb-4">Products</h2><div id="products" class="space-y-2"></div></div>
      </div>
    </div>
  </div>
  <script>
    let token = localStorage.getItem('token');
    if(token) showDashboard();
    
    async function login() {
      const res = await fetch('/api/auth/login', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({email: document.getElementById('email').value, password: document.getElementById('password').value})
      });
      const data = await res.json();
      if(data.token && data.user.role === 'admin') {
        localStorage.setItem('token', data.token);
        token = data.token;
        showDashboard();
      } else {
        alert('Invalid credentials or not admin');
      }
    }
    
    async function showDashboard() {
      document.getElementById('login').classList.add('hidden');
      document.getElementById('dashboard').classList.remove('hidden');
      
      const headers = {'Authorization': 'Bearer ' + token};
      const dash = await fetch('/api/admin/dashboard', {headers}).then(r=>r.json());
      const orders = await fetch('/api/admin/orders', {headers}).then(r=>r.json());
      const products = await fetch('/api/admin/products', {headers}).then(r=>r.json());
      
      document.getElementById('stats').innerHTML = `
        <div class="bg-gray-800 p-4 rounded"><div class="text-2xl font-bold">${dash.totalOrders||0}</div><div class="text-gray-400">Orders</div></div>
        <div class="bg-gray-800 p-4 rounded"><div class="text-2xl font-bold">₱${(dash.totalRevenue||0).toLocaleString()}</div><div class="text-gray-400">Revenue</div></div>
        <div class="bg-gray-800 p-4 rounded"><div class="text-2xl font-bold">${dash.totalProducts||0}</div><div class="text-gray-400">Products</div></div>
        <div class="bg-gray-800 p-4 rounded"><div class="text-2xl font-bold">${dash.totalUsers||0}</div><div class="text-gray-400">Users</div></div>
      `;
      
      document.getElementById('orders').innerHTML = (orders||[]).slice(0,10).map(o => 
        `<div class="bg-gray-800 p-3 rounded flex justify-between"><span>#${o.id}</span><span>₱${o.total}</span><span class="text-${o.status==='paid'?'green':'yellow'}-400">${o.status}</span></div>`
      ).join('');
      
      document.getElementById('products').innerHTML = (products||[]).slice(0,10).map(p => 
        `<div class="bg-gray-800 p-3 rounded flex justify-between"><span>${p.name}</span><span>₱${p.price}</span><span class="text-gray-400">${p.stock} in stock</span></div>`
      ).join('');
    }
  </script>
</body>
</html>
